
D:/gitlab-runner/build.fsx

27服务器(api)  ==> 星空和波多
36服务器(site )==> 星空平台
37服务器(波多site) ==> 波多系统


# 星空正式环境域名
* backstage.uoko.com		    boss后台	
* eval.uoko.com		            评价系统
* landlordcenter.uoko.com	    房源合伙人
* service.uoko.com		        服务商平台	
* passport.uoko.com		        SSO	
* i.uoko.com			        租客中心
* ushop.uoko.com                官网
* api.notify.uoko.com           短信邮件接口
* api.trade.uoko.com            支付接口
* cashier.uoko.com              收银台

 
# ~~星空上线要点~~
* 星空正式环境webconfig配置
* ids配置
* passport配置
* 更换数据库配置
* 支付key更换
* 官网城市域名更换
* 数据库里面还有域名站点的配置
* 支付key可以用webconfig, 可以配置在数据库
* jobs的也要配置


# ~~支付key重新检查~~ 
# ~~统一webconfig 的key命名~~
# ~~清理无效的配置~~
# ~~28服务器自己ping域名, ping其他服务器去了~~
# 邮件qq邮箱无法收到(qq.com后缀的邮箱都被视为垃圾邮件了)
# sso和支付都要在服务器配置hosts映射到本地来
# 121.41.0.138 api.systemset.uoko.com 配置映射内网IP

#fire业务流程
* 创建项目信息,选择**sln**,**csproj**文件路径
* 配置服务器信息(ip地址,存储路径)
* 配置服务器下的域名,IIS站点, 对应的项目名称, 以及手动在服务器建立对应的IIS站点名称(服务器配置web-deploy)
* 创建发版任务(可以发布**test**,**pre**环境), 选择项目, 分支, 部署环境, 服务器, 域名,通知人员
* 如果**pre**环境测试通过之后, 就可以点击**上线**发线上环境, 线上环境要求输入版本号, 便于回顾
* 可以通过**紧急回滚**操作, 选择要回滚版本进行回滚

#fire技术点
* 我们会在项目里面配置各个上线环境的配置文件(webconfig transfer),配置文件名称与域名一一对应,发版的时候自动进行对应配置文件的转换(开发人员可以在vs里面进行预览转换)
* 发**test**环境就直接发选择要部署的分支
* 发**pre**环境脚本自动把选择的分支**merge**到**pre**分支
* 发正式环境脚本自动把**pre**分支**merge**到**master**分支,同时会创建对应的**tag version**版本号


海信（Hisense）LED55EC530UA 55英寸 14核配置 炫彩4K VIDAA3智能电视(黑色)
海信（Hisense）LED55EC520UA 55英寸 VIDAA3 14核 炫彩4K智能电视(黑色)


landlordcenter.1.test.uoko.com	#房东中心
eval.1.test.uoko.com			#评价系统		
service.1.test.uoko.com		#服务系统	
backstage.1.test.uoko.com		#boss后台	
passport.1.test.uoko.com		#sso	
home.1.test.uoko.com			#个人中心
ushop.1.test.uoko.com         #官网

# 邮件发送查询sql
* select count(1) from InsideEmailSend where Statue=0 AND RecIDs <>'182' AND RecIDs <>'183'
* SELECT TOP 40 * FROM InsideEmailSend WHERE Statue=0  AND RecIDs <>'182' AND RecIDs <>'183' AND RecIDs <>''

# 关于数据库连接字符串加密问题
* 使用**DES,AES**来加解密, 但是目前星空采用T4模板生成上下文, 解密要去修改模板的构造函数
* 直接使用**spnet_regiis -pefpe**加密, 运行时程序自动解密. 如果能结合fire自动实现更好


# [日志易调研](https://www.rizhiyi.com/)


curl -X POST -T d:\curl\20161027.txt https://log.u.rizhiyi.com/bulk/e696061023e54d48961833b04c5a9952/tag/macbook/appname/macbook

curl -k -L d:\curl\20161027.txt\ | curl -k -X POST -H "content-type:text/plain" --data-binary @- https://log.u.rizhiyi.com/bulk/e696061023e54d48961833b04c5a9952/tag/sony

curl -k -L https://www.rizhiyi.com/install/RizhiyiSample.log | curl -k -X POST -H "content-type:text/plain" --data-binary @- https://log.ali.rizhiyi.com/bulk/e1aa7aac71dd4386bc1ac4d71b9b2307/tag/sony


curl -k -L "d:\curl\20161027.txt" | curl -k -X POST -H "content-type:text/plain" --data-binary @- https://log.ali.rizhiyi.com/bulk/e1aa7aac71dd4386bc1ac4d71b9b2307/tag/macbook



## online at http://nxlog.org/docs/
#define ROOT C:\Program Files\nxlog
define ROOT C:\Program Files (x86)\nxlog

Moduledir %ROOT%\modules
CacheDir %ROOT%\data
Pidfile %ROOT%\data\nxlog.pid
SpoolDir %ROOT%\data
LogFile %ROOT%\data\nxlog.log

<Extension syslog>
    Module    xm_syslog
</Extension>

<Extension fileop>
    Module      xm_fileop
</Extension>

<Extension _charconv>
    Module      xm_charconv
</Extension>

<Input internal>
    Module      im_internal
</Input>
<Input app_file0>
     Module       im_file
     File         "D:\\logs\\api.notify.uoko.com\\Error_2016-10-13.txt"
     SavePos      TRUE
     ReadFromLast TRUE
     PollInterval 1
     Exec $Filename = file_name();
</Input>
<Output app0output>
     Module      om_tcp
     Host        log.ali.rizhiyi.com
     Port        5140
     Exec $raw_event  =~ s/(\[.*])//g; $raw_event = replace($raw_event, '{', '[e1aa7aac71dd4386bc1ac4d71b9b2307@32473 tag="Xperia"] {', 1);
</Output>

<Route 1>
     Path         app_file0 => app0output
</Route>